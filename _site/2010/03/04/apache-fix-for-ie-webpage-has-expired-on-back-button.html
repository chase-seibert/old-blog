<!DOCTYPE html>
<html lang="en">
    <head>

        <title>Apache fix for IE "webpage has expired" on back button</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">

        <link href="/blog/css/bootstrap.css" rel="stylesheet">
        <link href="/blog/css/bootstrap-responsive.css" rel="stylesheet">
        <link href="/blog/css/pygments.css" rel="stylesheet">

        <link href="/blog/css/shCore.css" rel="stylesheet">

        <link href="/blog/css/base.css" rel="stylesheet">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='http://fonts.googleapis.com/css?family=Lato:900italic' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>

        <link href="/blog/atom.xml" rel="alternate" title="Chase Seibert | blog" type="application/atom+xml" />

        <link rel="canonical" href="/blog/2010/03/04/apache-fix-for-ie-webpage-has-expired-on-back-button.html" />

        <meta property="og:title" content="Apache fix for IE "webpage has expired" on back button"/>
        <meta property="og:type" content="article"/>
        <meta property="og:url" content="http://chase-seibert.github.com/blog/2010/03/04/apache-fix-for-ie-webpage-has-expired-on-back-button.html"/>
        <meta property="og:site_name" content="Chase Seibert | blog"/>
        <meta property="fb:admins" content="692280244"/>
        <meta property="og:description" content="Facts, hacks and attacks from my life as a web application developer" />

    </head>
    <body>

        <div class="container-fluid">

            <div class="row">

                <div class="span2">
                </div>

                <div class="span8 content">
                    
                        <h1>
                            Apache fix for IE "webpage has expired" on back button
                            
                                <span class="post-date subtitle">04 Mar 2010</span>
                            
                        </h1>
                    
                    <p>
When you refresh a webpage that was the result of a HTTP POST, your browser asks you if you want to reload.
</p>

<p>
   <img src="http://lh3.ggpht.com/_EE2zVzGv1Ds/S5FfHNuReqI/AAAAAAAALKM/WVIh1IyW6vk/s800/Screenshot-Confirm.png" />
</p>

<p>
The reason for this dialog is to stop the user from inadvertently submitting the same blog post/email message/payment details multiple times. That behaviour is standardised across all browsers. What's not standardised is what happens when you use the "Back" button to navigate to a previous POST page. In most browsers, you get the page from your cache. In IE, you get the dreaded "webpage has expired":
</p>

<p>
   <img src="http://lh5.ggpht.com/_EE2zVzGv1Ds/S5FgR6HI5uI/AAAAAAAALKU/got-17Gpagg/s800/expired_page.png" />
</p>

<p>
The intention here is good. This is a fool proof mechanism for keeping the user from submitting that page again. But what if your site can actually handle that? Why break the back button this way? A good counter example is a search engine. The search string may be sent via HTTP POST, but you would still like the user to be able to hit "back", change the search string, and hit submit again. In IE, you need a work-around for this.
</p>

<p>
The most common work-around is to <a href="http://stackoverflow.com/questions/1580085/show-webpage-has-expired-on-back-button#answer-1580126">redirect the POST to a GET</a> on the server side, aka the <a href="http://www.theserverside.com/tt/articles/article.tss?l=RedirectAfterPost">PRG Pattern</a>. This adds some back-end code, but generally solves the problem. However, it can get complicated if you are doing server-side validation, as you generally want to show the form again with validation exceptions in that case. So then you have to persist the temporary state of the FORM in either the session state or the database... messy.
</p>

<p>
Another solution is to use GETs in the first place. This is ok for some things, like Google searches, but does not work if you need to <a href="http://classicasp.aspfaq.com/forms/what-is-the-limit-on-querystring/get/url-parameters.html">pass a lot of form data</a> between pages. Also, it ignores the principle of <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.2">idempotence</a>, which for HTTP means that you should not use GETs for state-changes.
</p>

<p>
The work-around I have been using recently is to not send a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.44">Vary header</a> for IE only.
</p>

<blockquote>The Vary field value indicates the set of request-header fields that fully determines, while the response is fresh, whether a cache is permitted to use the response to reply to a subsequent request without revalidation.</blockquote>

<p>
In Apache, this is a simple configuration change in httpd.conf:
</p>

<pre name="code" class="python">
BrowserMatch MSIE force-no-vary
</pre>

<p>
The practical effect is that when you go "back" to a POST, IE simply gets the page from the history cache. No request at all goes to the server side. I would be interested in hearing about potential down-sides of this solution, other than the fact that the user can submit the form twice. In my case, this is handled already by the <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> token.
</p>

<hr>
Follow <a href='https://twitter.com/chase_seibert'>@chase_seibert</a> on Twitter

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'chaseseibertblog';
    var disqus_identifier = '/blog/2010/03/04/apache-fix-for-ie-webpage-has-expired-on-back-button';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

                </div>

                <div class="span2">

                    <h2 class="title"><a href="/blog/index.html">Chase Seibert</a></h2>
                    <p class="sub-title">
                        Facts, hacks and attacks from my life as a web application developer
                    </p>

                    <a href="http://stackexchange.com/users/4942/chase-seibert" class="stackoverflow"><img src="http://stackexchange.com/users/flair/4942.png" width="208" height="58" alt="profile for Chase Seibert on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Chase Seibert on Stack Exchange, a network of free, community-driven Q&amp;A sites" /></a>

                    <br><br>

                    
                        <div class="tags">
                            <h4>Tags</h4>
                            <ul>
                                
                            </ul>
                        </div>
                    

                    
                        <div id="related">
                            <h4>Related Posts</h4>
                            <ul class="posts">
                                
                                    <li><a href="/blog/2015/03/27/software-engineering-fireside-chat.html">Introducing the Software Engineering Fireside Chat Podcast</a></li>
                                
                                    <li><a href="/blog/2015/02/10/one-on-ones.html">Topics for One on Ones</a></li>
                                
                                    <li><a href="/blog/2014/12/22/class-design.html">Thoughts on Object Oriented Class Design</a></li>
                                
                            </ul>
                        </div>
                    

                    <div class="socials">
                        <h4>Social Links</h4>
                        <ul>
                            <li><a href="https://www.linkedin.com/in/chaseseibert">LinkedIn</a></li>
                            <li><a href="https://www.facebook.com/chase.seibert">Facebook</a></li>
                            <li><a href="https://twitter.com/chase_seibert">Twitter</a></li>
                            <li><a href="https://dl.dropbox.com/u/422013/resume.pdf">Resume</a></li>
                        </ul>
                    </div>

                </div>
            </div>
        </div>

        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <script src="/blog/js/bootstrap.js"></script>
        <script src="/blog/js/shCore.js"></script>
        <script src="/blog/js/shBrushBash.js"></script>
        <script src="/blog/js/shBrushCpp.js"></script>
        <script src="/blog/js/shBrushCSharp.js"></script>
        <script src="/blog/js/shBrushCss.js"></script>
        <script src="/blog/js/shBrushJava.js"></script>
        <script src="/blog/js/shBrushJScript.js"></script>
        <script src="/blog/js/shBrushPhp.js"></script>
        <script src="/blog/js/shBrushPython.js"></script>
        <script src="/blog/js/shBrushSql.js"></script>
        <script src="/blog/js/shBrushRuby.js"></script>
        <script src="/blog/js/shBrushXml.js"></script>

        <script type="text/javascript">
            dp.SyntaxHighlighter.BloggerMode();
            dp.SyntaxHighlighter.HighlightAll("code");
        </script>

        <script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-34759164-1']);
            _gaq.push(['_trackPageview']);

            (function() {
             var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
             ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
             var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();

        </script>
    </body>
</html>
